#!/bin/bash

app_path="${1}"

if [ -z "${1}" ]; then
  echo "Error: Please provide path to application" && exit 1
elif [ ! -d "${app_path}" ]; then
  echo "Error: Could not find app at '${app_path}'"
else
  echo "=> Create package from '${app_path}'"
fi

app=$(basename "${app_path}")
bundle="${app%.*}"

version="$(defaults read "${app_path}/Contents/Info.plist" CFBundleShortVersionString)"

pkgbuild --install-location "/Applications" --component "${app_path}" "/tmp/${bundle}-${version}.pkg" >/dev/null 2>&1

if [ -s "/tmp/${bundle}-${version}.pkg" ]; then
  echo "=> Successfully created package at '/tmp/${bundle}-${version}.pkg'"
fi
