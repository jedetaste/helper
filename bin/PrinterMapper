#!/bin/bash

  readonly progName=$(/usr/bin/basename ${0})
  readonly progVersion="1.0"
  
  argQueueName="${1}"
  argURI="${2}"
  argModel="${3}"
  argLocation="${4}"
  
  if [ -z "${1}" ] || [ -z "${2}" ] || [ -z "${3}" ]; then
    echo "Error: Invalid argument" && exit 1
  fi
  
  if [ -s "/etc/cups/ppd/${argQueueName}.ppd" ]; then
    /usr/sbin/lpadmin -x "${argQueueName}"
  fi
  
  /usr/sbin/lpadmin \
    -p "${argQueueName}" \
    -v "lpd://${argURI}/" \
    -P "/Library/Printers/PPDs/Contents/Resources/${argModel}.gz" \
    -o printer-is-shared=false \
    -L "${argLocation}"
  
  /usr/sbin/cupsenable "${argQueueName}" -E && /usr/sbin/cupsaccept "${argQueueName}"